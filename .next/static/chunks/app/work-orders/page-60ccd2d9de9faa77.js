(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{674:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(5155),s=a(2115),l=a(4982),n=a(9509);let o=async e=>{let t=(0,l.UU)("https://scjjkmuwadwkaaqjoigx.supabase.co/",n.env.SUPABASE_SERVICE_ROLE_KEY),{data:a,error:r}=await t.from("work_orders").select("*").eq("id",e).single(),{data:s,error:o}=await t.from("work_order_lines").select("*").eq("work_order_id",e);if(r||o)throw Error((null==r?void 0:r.message)||(null==o?void 0:o.message)||"Failed to fetch work order");return{...a,lines:s||[]}};function i(e){var t;let{line:a,onUpdate:l}=e,[n,o]=(0,s.useState)(a);return(0,s.useEffect)(()=>{l(n)},[n]),(0,r.jsxs)("div",{className:"bg-white dark:bg-surface border rounded-lg p-4 mb-4 shadow-card",children:[(0,r.jsx)("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-100",children:"Complaint"}),(0,r.jsx)("input",{value:n.complaint,onChange:e=>o({...n,complaint:e.target.value}),className:"w-full border rounded px-2 py-1 mb-3 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"}),(0,r.jsx)("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-100",children:"Cause"}),(0,r.jsx)("input",{value:n.cause||"",onChange:e=>o({...n,cause:e.target.value}),className:"w-full border rounded px-2 py-1 mb-3 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"}),(0,r.jsx)("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-100",children:"Correction"}),(0,r.jsx)("input",{value:n.correction||"",onChange:e=>o({...n,correction:e.target.value}),className:"w-full border rounded px-2 py-1 mb-3 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"}),(0,r.jsx)("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-100",children:"Labor Time (hrs)"}),(0,r.jsx)("input",{type:"number",value:null!=(t=n.labor_time)?t:"",onChange:e=>o({...n,labor_time:parseFloat(e.target.value)}),className:"w-full border rounded px-2 py-1 mb-3 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"}),(0,r.jsx)("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-100",children:"Status"}),(0,r.jsxs)("select",{value:n.status||"unassigned",onChange:e=>o({...n,status:e.target.value}),className:"w-full border rounded px-2 py-1 mb-3 bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"unassigned",children:"Unassigned"}),(0,r.jsx)("option",{value:"assigned",children:"Assigned"}),(0,r.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,r.jsx)("option",{value:"on_hold",children:"On Hold"}),(0,r.jsx)("option",{value:"completed",children:"Completed"})]}),"on_hold"===n.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-100",children:"Hold Reason"}),(0,r.jsxs)("select",{value:n.hold_reason||"",onChange:e=>o({...n,hold_reason:e.target.value}),className:"w-full border rounded px-2 py-1 mb-3 bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"",children:"Select Reason"}),(0,r.jsx)("option",{value:"parts",children:"Parts Hold"}),(0,r.jsx)("option",{value:"authorization",children:"Awaiting Authorization"}),(0,r.jsx)("option",{value:"diagnosis_pending",children:"Waiting Diagnosis"}),(0,r.jsx)("option",{value:"other",children:"Other"})]})]})]})}var d=a(5695);function u(){let e=(0,d.useParams)(),t=null==e?void 0:e.id,[a,l]=(0,s.useState)([]),[n,u]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=async()=>{let e=await o(t);l((null==e?void 0:e.lines)||[]),u(!1)};t&&e()},[t]);let c=e=>{l(a.map(t=>t.id===e.id?e:t))},x={diagnose:1,repair:2,maintenance:3},g=[...a].sort((e,t)=>{var a,r;return(null!=(a=x[e.line_type||"repair"])?a:2)-(null!=(r=x[t.line_type||"repair"])?r:2)});return n?(0,r.jsx)("div",{className:"text-center py-10 text-gray-600 dark:text-gray-300",children:"Loading work order..."}):(0,r.jsxs)("div",{className:"max-w-3xl mx-auto py-10 px-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gray-800 dark:text-white",children:"Work Order Editor"}),g.map(e=>{var t;return(0,r.jsxs)("div",{className:"mb-6 border-b pb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-bold uppercase px-2 py-1 rounded ".concat("diagnose"===e.line_type?"bg-red-500 text-white":"repair"===e.line_type?"bg-yellow-400 text-black":"bg-blue-500 text-white"),children:e.line_type||"Repair"}),(0,r.jsxs)("span",{className:"text-xs px-2 py-1 rounded font-medium ".concat("completed"===e.status?"bg-green-600 text-white":"on_hold"===e.status?"bg-orange-500 text-white":"in_progress"===e.status?"bg-blue-500 text-white":"assigned"===e.status?"bg-gray-500 text-white":"bg-neutral-300 text-black"),children:[(null==(t=e.status)?void 0:t.replace("_"," "))||"unassigned","on_hold"===e.status&&e.hold_reason?" â€“ ".concat(e.hold_reason):""]})]}),(0,r.jsx)(i,{line:e,onUpdate:c})]},e.id)})]})}},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},7987:(e,t,a)=>{Promise.resolve().then(a.bind(a,674))}},e=>{var t=t=>e(e.s=t);e.O(0,[982,441,684,358],()=>t(7987)),_N_E=e.O()}]);