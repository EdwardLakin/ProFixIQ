(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94],{53:(e,t,r)=>{"use strict";r.d(t,{g:()=>i});var a=r(2115);let s="selectedVehicle",i=()=>{let[e,t]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=localStorage.getItem(s);if(e)try{t(JSON.parse(e))}catch(e){console.error("Failed to parse stored vehicle info:",e)}},[]),(0,a.useEffect)(()=>{e&&localStorage.setItem(s,JSON.stringify(e))},[e]),{vehicleInfo:e,updateVehicle:e=>{t(e),localStorage.setItem(s,JSON.stringify(e))},clearVehicle:()=>{t(null),localStorage.removeItem(s)}}}},1028:(e,t,r)=>{"use strict";r.d(t,{J:()=>i});var a=r(2115);let s=(0,r(9535).createBrowserClient)("https://scjjkmuwadwkaaqjoigx.supabase.co/","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjamprbXV3YWR3a2FhcWpvaWd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NzA0MjIsImV4cCI6MjA2NTI0NjQyMn0.ZyyUD5fJkLiSUCc9E8dIq2J8nW39VCzVJThlNxy8MVk");function i(){let[e,t]=(0,a.useState)(null);return(0,a.useEffect)(()=>{(async()=>{var e;let{data:{session:r}}=await s.auth.getSession();t(null!=(e=null==r?void 0:r.user)?e:null)})()},[]),{user:e}}},4795:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var a=r(5155),s=r(2115),i=r(4982);let o=(0,i.UU)("https://scjjkmuwadwkaaqjoigx.supabase.co/","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjamprbXV3YWR3a2FhcWpvaWd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NzA0MjIsImV4cCI6MjA2NTI0NjQyMn0.ZyyUD5fJkLiSUCc9E8dIq2J8nW39VCzVJThlNxy8MVk");async function l(e,t,r,a){let s=e.map(e=>({user_id:t,vehicle_id:r,work_order_id:a,complaint:e.complaint,cause:e.cause,correction:e.correction,tools:e.tools,labor_time:e.labor_time})),{data:i,error:l}=await o.from("work_order_lines").insert(s);if(l)throw Error(l.message);return i}var c=r(53),n=r(1028),u=r(9535);function d(){let e=(0,u.createBrowserClient)(),{vehicle:t}=(0,c.g)(),{user:r}=(0,n.J)(),[i,o]=(0,s.useState)([]),[l,d]=(0,s.useState)([]),[m,p]=(0,s.useState)(""),[h,I]=(0,s.useState)([]);(0,s.useEffect)(()=>{(async()=>{if(r&&(null==t?void 0:t.id)){let{data:r,error:a}=await e.from("menu_items").select("*").eq("vehicle_id",t.id);!a&&r&&o(r)}})()},[r,null==t?void 0:t.id]),(0,s.useEffect)(()=>{if(m.length>1){let e=m.toLowerCase();I(i.filter(t=>t.complaint.toLowerCase().includes(e)))}else I([])},[m,i]);let f=e=>{d([...l,{complaint:e.complaint,cause:e.cause||"",correction:e.correction||"",labor_time:e.labor_time||"",tools:e.tools||""}]),p(""),I([])};return(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h1",{className:"text-xl font-bold mb-2",children:"Create Work Order"}),(0,a.jsx)("input",{type:"text",value:m,onChange:e=>p(e.target.value),placeholder:"Enter complaint (e.g. B for brakes)",className:"w-full px-3 py-2 border rounded shadow mb-2"}),h.length>0&&(0,a.jsx)("ul",{className:"bg-white border shadow rounded mb-4 max-h-40 overflow-y-auto",children:h.map(e=>(0,a.jsxs)("li",{onClick:()=>f(e),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:[e.complaint," — ",e.labor_time," hr"]},e.id))}),l.map((e,t)=>(0,a.jsx)(WorkOrderLineEditor,{line:e,onUpdate:e=>{let r=[...l];r[t]=e,d(r)},onDelete:()=>{let e=[...l];e.splice(t,1),d(e)}},t))]})}let m=(0,i.UU)("https://scjjkmuwadwkaaqjoigx.supabase.co/","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjamprbXV3YWR3a2FhcWpvaWd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NzA0MjIsImV4cCI6MjA2NTI0NjQyMn0.ZyyUD5fJkLiSUCc9E8dIq2J8nW39VCzVJThlNxy8MVk");function p(e){let{inspectionId:t,userId:r,vehicleId:i}=e,[o,c]=(0,s.useState)(null),[n,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{try{let{data:e,error:a}=await m.from("inspection_items").select("*").eq("inspection_id",t);if(a||!e||0===e.length)throw Error("Could not load inspection items.");let s=function(e){let t=[];for(let s of e){var r,a;"".concat(s.category,": ").concat(s.item);let e=e=>(null==e?void 0:e.trim().toLowerCase())||"",i="fail"===s.status,o="empty"!==e(s.measurements);i&&(o?t.push("Replaced ".concat(s.item," (").concat(s.measurements,")")):(null==(a=s.notes)?void 0:a.toLowerCase().includes("replace"))?t.push(s.notes):t.push("Repaired or replaced ".concat(s.item))),e(s.item).includes("oil")&&(null==(r=s.notes)?void 0:r.includes("change"))&&t.push("Completed oil change"),e(s.item).includes("coolant")&&o&&t.push("Topped coolant to ".concat(s.measurements)),e(s.item).includes("battery")&&o&&t.push("Installed new battery (".concat(s.measurements," CCA)")),e(s.item).includes("tire pressure")&&o&&t.push("Set tire pressure to ".concat(s.measurements)),e(s.item).includes("tread depth")&&o&&t.push("Documented tread depth: ".concat(s.measurements))}return t.length>0?t.join(", ")+".":"All items passed or no actions required."}(e),{data:o,error:n}=await m.from("work_orders").insert([{user_id:r,vehicle_id:i,status:"generated",summary:s}]).select().single();if(n||!o)throw Error("Failed to create work order.");let d=o.id;c(d);let p=e.map(e=>({complaint:"".concat(e.category,": ").concat(e.item),cause:e.notes||"",correction:"fail"===e.status?"Repair or replace":"",tools:[],labor_time:""}));p.push({complaint:"General Repair Summary",cause:"",correction:s,tools:[],labor_time:""}),await l(p,r,i,d),u(p)}catch(e){console.error(e),h(e.message||"Unexpected error")}})()},[t,r,i]),p)?(0,a.jsxs)("p",{className:"p-4 text-red-500",children:["❌ ",p]}):o&&n?(0,a.jsx)(d,{userId:r,vehicleId:i,workOrderId:o,initialLines:n}):(0,a.jsx)("p",{className:"p-4 text-accent",children:"Generating work order from inspection..."})}},7721:(e,t,r)=>{Promise.resolve().then(r.bind(r,4795))}},e=>{var t=t=>e(e.s=t);e.O(0,[982,535,441,684,358],()=>t(7721)),_N_E=e.O()}]);